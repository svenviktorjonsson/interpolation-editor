=== Project Directory Structure ===
Root: C:\Users\viktor.jonsson\OneDrive - CellMax Technologies AB\Documents\Repositories\svenviktorjonsson\interpolation-editor
Relevant files and folders (excluding specified patterns):

.
├── README.md
├── constants.js
├── interpolation-editor.js
├── package.json
├── style.css
├── test-app.js
├── test.html
├── utils.js


=== File Contents ===

=== README.md ===


=== constants.js ===
// constants.js

// Defines the core algorithm for interpolation
export const INTERPOLATION_TYPE = {
    CUBIC_SPLINE: 'cubic_spline',
    CIRCULAR_ARC: 'circular_arc',
};

// Defines how corners/vertices are handled
export const CORNER_HANDLING = {
    PASS_THROUGH: 'pass_through', // Interpolate through the vertex
    CUT_ALL: 'cut_all',         // Approximate/fillet all vertices
    MIXED: 'mixed',             // Cut concave, pass through convex
};

// Defines the side for open paths (used in MIXED mode)
export const SIDE_MODE = {
    LEFT: 'left',
    RIGHT: 'right',
    BOTH: 'both', // For creating ribbons/outlines
};

// Defines how the radius for corner rounding is interpreted
export const RADIUS_MODE = {
    ABSOLUTE: 'absolute',   // A fixed value in drawing units
    RELATIVE: 'relative',   // A percentage of the shortest adjacent edge
};

// Default style object for a new interpolation preset
export const DEFAULT_STYLE = {
    id: `style_${Date.now()}`,
    name: 'New Spline Style',
    type: INTERPOLATION_TYPE.CUBIC_SPLINE,
    cornerHandling: CORNER_HANDLING.MIXED,
    side: SIDE_MODE.LEFT,
    radiusMode: RADIUS_MODE.RELATIVE,
    radiusValue: 0.5,
    tension: 0.5, // Specific to cubic splines
};

// UI and Preview canvas constants
export const PREVIEW_CANVAS_WIDTH = 256;
export const PREVIEW_CANVAS_HEIGHT = 256;
export const PREVIEW_BACKGROUND_COLOR = '#2D3748';
export const PREVIEW_GRID_COLOR = 'rgba(74, 85, 104, 0.8)';
export const PREVIEW_PATH_COLOR = '#A0AEC0';
export const PREVIEW_CURVE_COLOR = '#3B82F6';
export const PREVIEW_FILL_COLOR = 'rgba(59, 130, 246, 0.3)';
export const PREVIEW_POINT_RADIUS = 4;

=== interpolation-editor.js ===
// interpolation-editor.js
import * as C from './constants.js';
import * as U from './utils.js';

export default class InterpolationEditor {
    constructor(options = {}) {
        this.container = options.container || document.body;
        this.onSelect = options.onSelect || (() => {});

        this.state = {
            style: JSON.parse(JSON.stringify(C.DEFAULT_STYLE)),
            // Future-proofing
            isDirty: false,
            undoStack: [],
            redoStack: [],
        };

        this.wrapper = null; // Will be the main container element
        this.elements = {}; // Will hold references to key DOM elements
        this.previewCtx = null;
    }

    initialize() {
        if (this.wrapper) return;
        this._initializeDOM();
        this._setupEventListeners();
        this._updateUIFromState();
        this.drawPreview();
    }

    _initializeDOM() {
        this.elements = {};

        const createEl = (tag, options = {}) => {
            const el = document.createElement(tag);
            if (options.id) {
                el.id = options.id;
                const camelCaseId = options.id.replace(/-(\w)/g, (_, letter) => letter.toUpperCase());
                this.elements[camelCaseId] = el;
            }
            if (options.className) el.className = options.className;
            if (options.text) el.textContent = options.text;
            if (options.value) el.value = options.value;
            if (options.type) el.type = options.type;
            if (options.name) el.name = options.name;
            for (const key in options.attrs) {
                el.setAttribute(key, options.attrs[key]);
            }
            return el;
        };

        this.wrapper = createEl('div', { id: 'interpolation-editor-wrapper', className: 'interpolation-editor-container' });
        this.wrapper.style.display = 'none';

        // --- Preview Panel (Left, 2x2) ---
        const previewPanel = createEl('div', { className: 'editor-panel preview-panel' });
        const previewHeader = createEl('div', { className: 'panel-header', text: 'Preview' });
        const previewCanvasContainer = createEl('div', { className: 'preview-canvas-container' });

        this.elements.previewCanvas = createEl('canvas', { id: 'preview-canvas' });
        this.elements.previewCanvas.width = C.PREVIEW_CANVAS_WIDTH;
        this.elements.previewCanvas.height = C.PREVIEW_CANVAS_HEIGHT;
        this.previewCtx = this.elements.previewCanvas.getContext('2d');
        
        previewCanvasContainer.append(this.elements.previewCanvas);
        previewPanel.append(previewHeader, previewCanvasContainer);

        // --- Style Panel (Top Right, 2x1) ---
        const stylePanel = createEl('div', { className: 'editor-panel style-panel' });
        const styleHeader = createEl('div', { className: 'panel-header', text: 'Style' });
        
        const nameGroup = createEl('div', { className: 'parameter-group' });
        nameGroup.append(
            createEl('div', { className: 'parameter-group-header', text: 'Style Name' }),
            createEl('input', { type: 'text', id: 'style-name-input', className: 'value-input', attrs: { style: 'text-align: left; padding: 4px 8px;' }})
        );
        stylePanel.append(styleHeader, nameGroup);

        // --- Options Panel (Bottom Right, 2x1) ---
        const optionsPanel = createEl('div', { className: 'editor-panel options-panel' });
        const optionsHeader = createEl('div', { className: 'panel-header', text: 'Options' });

        // Corner Handling
        const cornerGroup = createEl('div', { className: 'parameter-group' });
        const cornerRadioGroup = createEl('div', { className: 'radio-button-group' });
        cornerRadioGroup.append(
            createEl('input', { type: 'radio', id: 'ch-pass', name: 'cornerHandling', value: C.CORNER_HANDLING.PASS_THROUGH }),
            createEl('label', { text: 'Pass Through', attrs: { for: 'ch-pass' } }),
            createEl('input', { type: 'radio', id: 'ch-cut', name: 'cornerHandling', value: C.CORNER_HANDLING.CUT_ALL }),
            createEl('label', { text: 'Cut All', attrs: { for: 'ch-cut' } }),
            createEl('input', { type: 'radio', id: 'ch-mixed', name: 'cornerHandling', value: C.CORNER_HANDLING.MIXED }),
            createEl('label', { text: 'Mixed', attrs: { for: 'ch-mixed' } })
        );
        cornerGroup.append(
            createEl('div', { className: 'parameter-group-header', text: 'Corner Handling' }),
            cornerRadioGroup
        );

        // Tension Slider
        const tensionGroup = createEl('div', { className: 'parameter-group' });
        const tensionSliderContainer = createEl('div', { className: 'slider-container' });
        tensionSliderContainer.append(
            createEl('input', { type: 'range', id: 'tension-slider', attrs: { min: '0', max: '1', step: '0.01' } }),
            createEl('input', { type: 'number', id: 'tension-input', attrs: { min: '0', max: '1', step: '0.01' } })
        );
        tensionGroup.append(
            createEl('div', { className: 'parameter-group-header', text: 'Tension' }),
            tensionSliderContainer
        );
        
        const buttonRow = createEl('div', { className: 'button-row' });
        buttonRow.append(
            createEl('button', { id: 'cancel-button', className: 'editor-button secondary', text: 'Cancel' }),
            createEl('button', { id: 'save-button', className: 'editor-button primary', text: 'Save Style' })
        );

        optionsPanel.append(optionsHeader, cornerGroup, tensionGroup, buttonRow);

        this.wrapper.append(previewPanel, stylePanel, optionsPanel);
        this.container.appendChild(this.wrapper);
    }

    _setupEventListeners() {
        const { tensionSlider, tensionInput, saveButton, cancelButton, styleNameInput } = this.elements;

        styleNameInput.addEventListener('change', (e) => {
            this.state.style.name = e.target.value;
        });
        
        this.wrapper.querySelectorAll('input[name="cornerHandling"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (e.target.checked) {
                    this.state.style.cornerHandling = e.target.value;
                    this.drawPreview();
                }
            });
        });

        const syncTension = (value) => {
            this.state.style.tension = parseFloat(value);
            tensionSlider.value = this.state.style.tension;
            tensionInput.value = this.state.style.tension;
            this.drawPreview();
        };

        tensionSlider.addEventListener('input', (e) => syncTension(e.target.value));
        tensionInput.addEventListener('change', (e) => syncTension(e.target.value));
        
        saveButton.addEventListener('click', () => {
            this.state.style.name = this.elements.styleNameInput.value;
            this.onSelect(this.state.style);
            this.hide();
        });
        
        cancelButton.addEventListener('click', () => {
            this.hide();
        });
    }
    
    _updateUIFromState() {
        const { style } = this.state;
        const { styleNameInput, tensionSlider, tensionInput } = this.elements;
        
        styleNameInput.value = style.name;
        this.wrapper.querySelector(`input[name="cornerHandling"][value="${style.cornerHandling}"]`).checked = true;
        tensionSlider.value = style.tension;
        tensionInput.value = style.tension;
    }

    drawPreview() {
        if (!this.previewCtx) return;

        const ctx = this.previewCtx;
        const w = this.elements.previewCanvas.width;
        const h = this.elements.previewCanvas.height;

        // Clear canvas
        ctx.fillStyle = C.PREVIEW_BACKGROUND_COLOR;
        ctx.fillRect(0, 0, w, h);

        // Draw sample path (e.g., a simple 'S' curve)
        const samplePoints = [
            { x: w * 0.1, y: h * 0.2 },
            { x: w * 0.4, y: h * 0.8 },
            { x: w * 0.6, y: h * 0.2 },
            { x: w * 0.9, y: h * 0.8 },
        ];
        
        // Draw the interpolated curve
        const curvePoints = U.calculateCubicSpline(samplePoints, this.state.style.tension, false);
        
        ctx.strokeStyle = C.PREVIEW_CURVE_COLOR;
        ctx.lineWidth = 2;
        ctx.beginPath();
        curvePoints.forEach((p, i) => {
            if (i === 0) ctx.moveTo(p.x, p.y);
            else ctx.lineTo(p.x, p.y);
        });
        ctx.stroke();

        // Draw original points
        ctx.fillStyle = C.PREVIEW_PATH_COLOR;
        samplePoints.forEach(p => {
            ctx.beginPath();
            ctx.arc(p.x, p.y, C.PREVIEW_POINT_RADIUS, 0, Math.PI * 2);
            ctx.fill();
        });
    }

    show(styleToEdit = null) {
        if (styleToEdit) {
            this.state.style = JSON.parse(JSON.stringify(styleToEdit));
        } else {
            this.state.style = JSON.parse(JSON.stringify(C.DEFAULT_STYLE));
            this.state.style.id = `style_${Date.now()}`;
        }
        this.wrapper.style.display = 'grid';
        this._updateUIFromState();
        this.drawPreview();
    }

    hide() {
        this.wrapper.style.display = 'none';
    }
}

=== package.json ===
{
  "name": "interpolation-editor",
  "version": "1.0.0",
  "description": "a popup for editing interpolation styles",
  "homepage": "https://github.com/svenviktorjonsson/interpolation-editor#readme",
  "bugs": {
    "url": "https://github.com/svenviktorjonsson/interpolation-editor/issues"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/svenviktorjonsson/interpolation-editor.git"
  },
  "license": "MIT",
  "author": "Viktor Jonsson",
  "type": "commonjs",
  "main": "interpolation-editor.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  }
}


=== style.css ===
/* ========== INTERPOLATION EDITOR STYLES ========== */

.interpolation-editor-container {
    font-family: 'Inter', sans-serif;
    user-select: none;
    background-color: #2d3748; 
    padding: 0.5rem;
    border-radius: 0.5rem;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(2, 1fr);
    gap: 0.5rem;
    width: 800px;
    height: 400px;
    box-sizing: border-box;
}

/* ========== PANELS & HEADERS ========== */
.editor-panel {
    background-color: rgba(45, 55, 72, 0.5);
    border-radius: 0.375rem;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    padding: 0.375rem;
    gap: 0.75rem;
}

.preview-panel {
    grid-column: 1 / 3;
    grid-row: 1 / 3;
}

.style-panel {
    grid-column: 3 / 5;
    grid-row: 1 / 2;
}

.options-panel {
    grid-column: 3 / 5;
    grid-row: 2 / 3;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: #4a5568 #2d3748;
}

.options-panel::-webkit-scrollbar { width: 6px; }
.options-panel::-webkit-scrollbar-track { background: #2d3748; }
.options-panel::-webkit-scrollbar-thumb { background-color: #4a5568; border-radius: 3px; }

.panel-header {
    font-size: 0.8rem;
    font-weight: 600;
    color: #cbd5e0;
    padding: 0.25rem 0.5rem;
    background-color: rgba(74, 85, 104, 0.5);
    border-bottom: 1px solid #4a5568;
    margin: -0.375rem -0.375rem 0;
    border-top-left-radius: 0.375rem;
    border-top-right-radius: 0.375rem;
    flex-shrink: 0;
}

.preview-canvas-container {
    flex-grow: 1;
    background-color: #2D3748;
    border-radius: 0.25rem;
    overflow: hidden;
}

#preview-canvas {
    width: 100%;
    height: 100%;
    border-radius: 0.25rem;
}

/* ========== CONTROL GROUPS ========== */
.parameter-group {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
}

.parameter-group-header {
    font-size: 0.7rem;
    font-weight: 600;
    color: #a0aec0;
    text-transform: uppercase;
    padding-bottom: 0.25rem;
    border-bottom: 1px solid #4a5568;
}

/* ========== BUTTONS & INPUTS ========== */
.radio-button-group {
    display: flex;
    gap: 0.25rem;
    background-color: #4a5568;
    border-radius: 0.25rem;
    padding: 2px;
}

.radio-button-group label {
    flex: 1;
    padding: 4px;
    font-size: 0.75rem;
    text-align: center;
    color: #a0aec0;
    background-color: transparent;
    border-radius: 0.25rem;
    cursor: pointer;
    transition: all 0.15s ease-in-out;
}

.radio-button-group input[type="radio"] {
    display: none;
}

.radio-button-group input[type="radio"]:checked + label {
    background-color: #3b82f6;
    color: white;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.slider-container {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.slider-container input[type="range"] {
    flex-grow: 1;
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 6px;
    background: #4a5568;
    border-radius: 3px;
    outline: none;
}

.slider-container input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 14px;
    height: 14px;
    background: #3b82f6;
    border-radius: 50%;
    cursor: pointer;
}

.value-input, .slider-container input[type="number"] {
    font-size: 0.75rem;
    background-color: #4a5568; 
    color: #e2e8f0;
    text-align: center; 
    border-radius: 0.25rem; 
    padding: 0.2rem; 
    border: 1px solid #718096;
}
.slider-container input[type="number"] {
    width: 50px;
}


.button-row {
    display: flex;
    gap: 0.5rem;
    margin-top: auto; /* Pushes buttons to the bottom */
}

.editor-button {
    flex: 1;
    padding: 8px;
    font-size: 0.8rem;
    font-weight: 500;
    border: none;
    border-radius: 0.25rem;
    cursor: pointer;
    transition: background-color 0.15s ease-in-out;
}

.editor-button.primary {
    background-color: #3b82f6;
    color: white;
}
.editor-button.primary:hover { background-color: #2563eb; }

.editor-button.secondary {
    background-color: #6b7280;
    color: #e2e8f0;
}
.editor-button.secondary:hover { background-color: #4b5563; }

=== test-app.js ===
import InterpolationEditor from './interpolation-editor.js';

document.addEventListener('DOMContentLoaded', () => {
    const openEditorButton = document.getElementById('open-editor-button');
    const outputDisplayWrapper = document.getElementById('output-display-wrapper');
    const outputDisplay = document.getElementById('output-display');
    
    let currentInterpolationStyle = null;

    // Initialize the editor
    const editor = new InterpolationEditor({
        container: document.body, // Append the editor to the body
        onSelect: (style) => {
            // This callback is invoked when the 'Save Style' button is clicked
            console.log('Style saved:', style);
            currentInterpolationStyle = style;
            displayStyleObject(currentInterpolationStyle);
        }
    });
    editor.initialize();

    // Show the editor when the button is clicked
    openEditorButton.addEventListener('click', () => {
        // Open with no initial state to create a new style
        editor.show();
    });

    // Re-open the editor with the current style on double-click
    outputDisplayWrapper.addEventListener('dblclick', () => {
        editor.show(currentInterpolationStyle);
    });

    /**
     * Displays the style object as a formatted JSON string.
     * @param {object} style - The interpolation style object from the editor.
     */
    function displayStyleObject(style) {
        if (style) {
            outputDisplay.textContent = JSON.stringify(style, null, 2);
        } else {
            outputDisplay.textContent = 'No style saved yet.';
        }
    }
});

=== test.html ===
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interpolation Editor Test Page</title>
    
    <link rel="stylesheet" href="style.css">
    
    <style>
        /* Basic styles for the test page */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #1a202c;
            color: #e2e8f0;
            margin: 0;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .content {
            text-align: center;
            margin-top: 2rem;
        }
        
        .instructions {
            margin: 1rem 0;
            font-size: 0.9rem;
            color: #a0aec0;
            max-width: 600px;
        }
        
        #open-editor-button {
            font-size: 1rem;
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-radius: 0.5rem;
            border: none;
            background-color: #3b82f6;
            color: white;
            transition: background-color 0.2s;
        }
        
        #open-editor-button:hover {
            background-color: #2563eb;
        }

        .output-section {
            margin-top: 2rem;
            width: 100%;
            max-width: 600px;
        }

        .output-label {
            font-size: 0.8rem;
            color: #a0aec0;
            margin-bottom: 0.5rem;
        }

        #output-display-wrapper {
            background-color: #2d3748;
            border: 1px solid #4a5568;
            border-radius: 0.375rem;
            padding: 1rem;
            min-height: 100px;
            cursor: pointer;
        }

        #output-display {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: monospace;
            font-size: 0.8rem;
            color: #cbd5e0;
        }

    </style>
</head>
<body>
    
    <div class="content">
        <h1>Interpolation Editor Test</h1>
        <div class="instructions">
            <p>Click the button to open the interpolation style editor.</p>
            <p>Click <strong>"Save Style"</strong> to see the resulting style object below.</p>
            <p>Double-click the output area to re-open the editor with the last saved style.</p>
        </div>
        <button id="open-editor-button">Open Interpolation Editor</button>
    </div>

    <div class="output-section">
        <div class="output-label">Current Interpolation Style (Double-click to edit)</div>
        <div id="output-display-wrapper">
            <pre><code id="output-display">No style saved yet.</code></pre>
        </div>
    </div>

    <script type="module" src="test-app.js"></script>
</body>
</html>

=== utils.js ===
// utils.js
import * as C from './constants.js';

/**
 * Calculates points for a Catmull-Rom spline (a type of cubic piecewise spline).
 * This is a great starting point for the 'Pass Through' and 'Mixed' modes.
 *
 * @param {Array<Object>} points - An array of points {x, y} the spline must pass through.
 * @param {number} tension - A value from 0 to 1 controlling the curve's tightness.
 * @param {boolean} closed - Whether the path is a closed loop.
 * @param {number} segments - The number of line segments to draw between each pair of points.
 * @returns {Array<Object>} An array of points representing the final curve.
 */
export function calculateCubicSpline(points, tension = 0.5, closed = false, segments = 16) {
    if (points.length < 2) return points;

    const path = [];
    const pts = [...points];

    if (closed) {
        pts.unshift(points[points.length - 1]);
        pts.push(points[0], points[1]);
    } else {
        pts.unshift(points[0]);
        pts.push(points[points.length - 1]);
    }

    const loopEnd = closed ? pts.length - 2 : pts.length - 1;
    for (let i = 1; i < loopEnd; i++) {
        if (i > 1 && !closed) {
             path.push({...pts[i]});
        }
        for (let t = 0; t <= segments; t++) {
            const s = t / segments;

            const p0 = pts[i - 1];
            const p1 = pts[i];
            const p2 = pts[i + 1];
            const p3 = pts[i + 2] || p2;

            const t01 = Math.pow(Math.hypot(p1.x - p0.x, p1.y - p0.y), tension);
            const t12 = Math.pow(Math.hypot(p2.x - p1.x, p2.y - p1.y), tension);
            const t23 = Math.pow(Math.hypot(p3.x - p2.x, p3.y - p2.y), tension);

            const m1 = {
                x: ((p2.x - p1.x) / t12 - (p1.x - p0.x) / t01) * (1 - tension) * t12,
                y: ((p2.y - p1.y) / t12 - (p1.y - p0.y) / t01) * (1 - tension) * t12
            };

            const m2 = {
                x: ((p3.x - p2.x) / t23 - (p2.x - p1.x) / t12) * (1 - tension) * t12,
                y: ((p3.y - p2.y) / t23 - (p2.y - p1.y) / t12) * (1 - tension) * t12
            };

            const a = 2 * (p1.x - p2.x) + m1.x + m2.x;
            const b = -3 * (p1.x - p2.x) - 2 * m1.x - m2.x;
            const c = m1.x;
            const d = p1.x;

            const e = 2 * (p1.y - p2.y) + m1.y + m2.y;
            const f = -3 * (p1.y - p2.y) - 2 * m1.y - m2.y;
            const g = m1.y;
            const h = p1.y;

            path.push({
                x: a * s * s * s + b * s * s + c * s + d,
                y: e * s * s * s + f * s * s + g * s + h,
            });
        }
    }
    return path;
}


=== LLM Instructions ===
Now please just read the project and the rules for writing code and just wait for instructions.

Here are the rules:
1. DONT write comments, placeholders or docstrings if not explicitely told.
2. Write functions with the correct initial indentation so that if the function is indented so is your code that you write.
3. Use regular spaces: " " and do not use " " for space.
4. For changes that require multiple replacements please tell me what to replace with what instead of rewriting large portions of text. You can use vscode valid regexp for instance.
5. For small functions less than 50 lines of code pleae rewrite the full function. For larger functions please only write complete control statements if/while/case.
6. Never omit/change working logic if not explicitely statet that it should be removed/change
7. DONT use the CANVAS TOOL where code is written in artifacts.
8. Write one functions that are new seperately ot functions that needs updated.
9. Make sure to write what has been change where to place/what to replace for each code snippet.
